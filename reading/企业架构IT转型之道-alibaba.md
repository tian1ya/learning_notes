### 序

互联网 + 电商 + 支付：特定决定ali必须要有很高的稳定性和可靠性，每一笔订单，订单的状态，每一次支付都不能有差错。

例如在双11，每秒要有十万比以上的订单，高可用。

**高可用、海量数据、复杂业务逻辑** 是阿里业务系统的主要挑战。

本书是阿里在应对此挑战的探索，在**技术上、组织架构**上。

技术上的探索

* 数据库水平扩展，去IOE
* 复杂业务系统的结构化服务化，业务减耦，SOA，EBS
* 大型系统消息处理
* 关键业务系统的实时调控



再好的技术和框架如果不给企业带来业务价值，就没有太大意义，所以本书更多是从**技术架构解决了什么问题**，企业收获了哪些业务价值的角度进行说明和阐述，并没有描述太多晦涩的理论、算法和模型。

---

### Chpt01

> *阿里巴巴共享业务事业部发展历程中所遇到的一系列问题和困境*

**大中台、小前台**

**中台**： 集合整个集团的运营数据能力、产品技术能力，对前台业务形成支持



淘宝和天猫，技术架构上初期都拥有独立的商品、交易、评价、支付、物流等功能。

成立共享事业部，梳理淘宝和天猫的业务和功能，将公共的、通用的功能沉淀到该事业部，避免功能的重复建设和维护，更加合理的利用资源

**厚平台、薄应用**

共享事业部，**厚平台**的体现，将前台应用中公共的业务进行沉淀 **包含了用户中心、商品中心、交易中心、评价等**

![a](./pcis/ali01.png)

**以上共享事业部**打磨过程和验证的这套方案，可能是让非互联网行业的企业摆脱困境的最好出路。为什么呢。细细如下分析：

* 烟囱式建设模式

三大电商体系技术独立支持架构，独立开发，独立运维

![a](./pcis/ali02.png)

导致这由可能的原因有：

1. 开发团队考虑到电商模式的不同，所以需要独立建设
2. 新的业务团队认为在之前的电商平台基础上改造会有历史包袱，还不如重新构建

而这由的事情在其他企业几乎天天发生，基本上没新上一个系统，也就预示着一个新的烟囱形成，长期就导致烟囱林立，这也是很多企业面临互联网转型困难的根节所在。

烟囱的系统建设弊端

1. 重复功能建设和维护带来的重复投资

2. 打通烟囱系统的**交互的集成和协作成本**，例如要获取用户的消费行为，爱好等信息，要进行分析做到精准营销，但是发现会员信息、商品信息、订单信息等都被烟囱式的系统建设分到不同的系统中，因此需要不得不打通这些烟囱，从而获取到平台所需的全局用户消费信息。

   基于此问题，提出各种`SOA` 理念的`ESB`产品以及解决方案。

3. 不利于业务的沉淀和持续发展，增加新功能困难，要动业务逻辑，甚至是数据库，普遍本着**多一事不如少一事，不动就不会出错的原则**而不愿意对已经上线的功能进行修改，这是对企业伤害最大的，这种方式始终无法满足业务快速响应和业务模式创新的需求，时间长了就是**推倒重来**，这由对于之前多年业务的沉淀保留多少，扔掉多少，是最大的资产损失。

这些问题本质上都是由于系统所提供的服务能力没有随着企业业务的发展做到与时俱进。业务发展迅速，由量变到质变，于是系统就推到重来了。

**什么才是懂业务**

懂业务不是说对具体流程、操作、数据模型方面，而是说对业务的下一步发展有这自己的理解和看法，对业务流程如何进一步优化更好第提升业务，甚至是能够提出创新的想法，为业务带来新的业务增长点。

但是IT人员不动业务，其原因中一方面IT信息化部门一直处于“业务支持”的职能位置，即只是为了满足业务部门需求而进行IT系统建设的实施和运维部门。其最大价值也自认为是负责项目的上线，甚至是同时可以负责多个项目。

而如何摆脱这样的困境，选择什么样的IT业务架构以及基于哪些技术原则为企业真正打造一个在互联网时代满足业务发展的IT基础架构呢 ？

### chpt02 

共享服务体系的建设，使得ali摆脱了烟囱式的系统建设，是ali中台战略的核心组成

#### SOA 服务重用

> SOA理念最核心的价值：**松耦合**的服务带来业务的**复用**，通过服务的**编排**助力业务的**快速响应和创新**

SOA 在企业落地中，几乎无一例外都是通过搭建ESP(企业服务总线)，使得各个系统以服务封装/调用的方式实现不同系统之间的业务交互

![a](./pcis/ali03.png)

以上中台，前台设计，解决了【烟囱的系统建设弊端】中的前两条

1. 解决重复建设和维护带来的成本浪费。

   不管是1688还是淘宝或者聚划算都会有创建订单流程，这些流程也会因为业务场景的不同，而有所不同，但是无论在那个条件下，都会存在会员信息的验证、商品库存的修改等，将这些通用 的流程单独抽象出来下城到共享服务，1688还是淘宝或者聚划算就都可以共享这些通用服务了。

2. 解决【**交互的集成和协作成本**】例如当1688和淘宝网前端需要交互的时候，他们直接可以不直接通过EBS进行交互，因为各个应用核心业务层都已经通过共享服务体系实现统一，直接在共享服务内部统一就可以完成协作和交互。

3. 解决【业务的沉淀和持续发展】

   拥抱变化，SOA项目不在是基于**一种**集成项目建设的方式，也不需要追求**业务稳定**，需要新的增长的业务不断的滋养，从一开始单薄的业务功能逐渐长期、持续的成长为企业最为宝贵的IT资产。

   这里更多是一种思维、态度的改变。企业要多写耐心，避免走入**项目制(单独为xxx服务)**，不断将抽象出来的公共共享服务可以为各种前端业务应用所所用。



#### 共享服务是培训创新的土壤

好的创新一定是从自己的土壤中长出来的，而不是从哪里借鉴或者抄过来的，所谓业务专家，那么一定是在改领域中有体系知识，这个知识也一定是从点到线再到面的一个形成过程，而共享服务就有这个的环境。

以交易中心为例，不同的业务交易场景，如1688、淘宝、天猫都会有各自交易流程的业务架构师，他们对各自的交易业务十分擅长，这些都是各个业务场景中对交易业务的**点**，而这些交易流程中关键的核心的可共享流程都是下沉到共享层的交易中心，那么共享交易中心的架构师锁接触到不同业务模式下的交易相关需求，他所接触到的是业务的**线到面**。

那么在阿里内部是由创新产生一个BCP business Check Platform 的平台，改平台用来使用业务规则的方式，对交易业务镜像逻辑上的验证，例如用户退单后，退单流程走了，退货流程走了，退款流程也走了，但是会员中心没有将其积分扣除，改系统就是用于发现这些业务流程上的Bug。

#### 赋予业务快速创新和试错能力

先投入小团队，基于共享平台能力实现一个MVP产生，然后快速投入市场，如果市场反应平平，那么可以证明这个产品不怎么样，就算直接砍掉，那也是很小成本的事情，但是如果市场反应很好，那么就可以网上堆资源，快速迭代开发。

聚划算就是这样产生的。

这就好比侦察兵，一袋发现有敌情，那么快速呼叫远程炮火进行攻击，呼叫支援。



共享中的架构师，产生专门的业务架构师，带来领域专家，给组织效能也带来了提升



对共享服务体系有一个全局概念式的理解，它就是抽离出上层业务可共享的，最核心的业务功能，它是领域级别的，例如会员共享服务、交易共享服务等。将企业领域能力沉淀下来，这样的共享服务的产生对组织，对个人都是有一个快速试错并掉头的机会，对于个人在领域知识更是有一个全面的理解，并提供一个可以达到领域专家的机会。

所以说共享服务体系是一个**赋能** 的角色，可以给企业赋能，给个人赋能。

对于共享领域，他是上层业务系统的基石，这就要它在稳定性、可扩展性、需求快速响应等能力更高的要求。需要成熟完善的技术体系支撑



### chp03

#### 分布式服务框架

* 单一系统转变为服务化架构改变的过程
* 什么是去中心化

淘宝期初是一个超过500人的团队，一起维护一个WAR包，存在这由的问题

1. 项目团队协助成本高，业务响应越来越慢

   代码合并冲突多，代码不一致

2. 应用复杂度高

   没有人能够掌握全部系统功能知识，平台打包发布的时候，就会蕴含比较大的风险

3. 错误难隔离

   非核心功能，会影响到核心功能，二者是运行在一个环境中的

4. 数据库链接难扩展

   所有业务均打包在一个war包，所有的数据也都保存在同一个数据库中，造成数据链接池资源紧张

5. 应用扩展成本高

解决以上问题根本在**业务拆分**

#### 中心化与去中心化

##### SOA

* 面向服务分布式计算
* 服务间松耦合
* 支持服务的封装
* 服务注册和发现
* 服务契约方式定义服务交互方式

中心化”和“去中心化”服务框架均是SOA的实现，并不是两套体系，且没有优劣之分。



企业建了很多烟囱式的系统，各个系统使用的技术平台、框架、语言各异。当需要在这些系统间进行点对点的交互时候，ESB避免了在服务调用提供方接口改变的时候，服务调用方都需要跟着改变，而治需要在ESB上面调整就好，ESB降低系统之间的耦合，同时也提供了负载均衡，服务管控等能力。

中心化和可扩展性是不可同时具备的，可扩展性意味着集群中的不可靠节点中随时会删除，以及增加可靠节点。所以不能固定某个节点为master，master 是随着机器的增加或者删除随时产生的。

而在互联网产品中，随着用户的增加，系统可扩展是系统不崩溃的前提，是一切业务发展的前提。所以**互联网产品基本都会选择去中心化的架构**

去中心化要求服务提供者和服务调用者直接无需通过任何服务路由中介，避免因为**中心点** 出问题带来难扩展，以及潜在的**雪崩**，采用点对点的调用。



ESB的架构师这样的

![a](./pcis/ali04.png)

这是中心化的设计，每次调用都需要通过服务总线。而且这个总线一旦有问题，那么系统就GG。且所有请求都要经过它，请求多了，它的压力也大。也会有雪崩。

去中心化的架构是这样的

![a](./pcis/ali05.png)



##### 微服务

* 分布式服务组成的系统。
* 按照业务而不是技术来划分组织。
* 做有生命的产品而不是项目。
* 智能化服务端点与傻瓜式服务编排。
* 自动化运维。
* 系统容错。
* 服务快速演化。

微服务”是SOA的一种演变后的形态，与SOA的方法和原则没有本质上的差别，在进行二者对比，会有以下差异







