> 基础知识对于调优技术的决定性

#### 调优指标

在项目早期，么有必要在意性能的优化，这由反而影响到开发进度，此时只需要保证有效的编码，如：

1. 减少I/O操作
2. 降低竞争锁的使用
3. 高效的算法
4. 复杂的业务充分利用设计模式优化代码

系统编码结束之后就可以开始性能测试了，有哪些参考因素可以体现系统的性能呢？

1. CPU 当需要大量的计算，会长时间的占用CPU资源，如代码无限循环，正则表达式引起回溯，JVM的FULL GC，以及多线程编码造成的大量上下文切换。
2. 内存 堆内存占用过高，导致内存溢出、内存泄漏
3. 磁盘I/O 读写磁盘太慢
4. 网络 
5. 异常 JAVA异常的时候会构建异常栈，对异常的捕获和处理，这个过程很消耗系统性能，高并发下应发的持续的进行异常处理，系统性能明显受到影响
6. 数据库
7. 锁竞争 锁的使用带来上下文切换，额外的系统开销，如何合理的使用锁资源，优化锁，需要了解更多的操作系统的执行，java 多线程编码



下面的几个指标，是系统性能的重要指标

1. 响应时间

2. 吞吐： TPS(秒杀事务处理)，体现接口的性能，其越大性能越好，QPS

3. 计算机资源分配使用率，内存使用率、磁盘I/O、网络I/O的资源使用率。这是一个木桶效应，任何一个出现短板，对整个系统的影响都是毁灭的

4. 负载承受能力

   系统响应时间上升曲线是否平缓能够反馈系统负载的上限，系统响应时间随着系统并发的增加而延长，知道系统无法处理这么多请求，抛出大量异常，就到了极限。



系统负载:单位时间内正在运行或者等待的进程/线程个数。

CPU利用率:单位时间内一个线程或者进程实时占用CPU的百分比

> CPU密集性情况，系统的负载未必高，但是CPU的利用率肯定很高，因为一个线程/进程一直在计算。
>
> 对于I/O密集型的程序来说，CPU的利用率不高，但是系统的负载却很高，这是因为I/0经常引起阻塞，这样导致很多线程/进程被阻塞等待状态，处于等待的线程/进程属于负载线程/进程。



#### 调优攻略

测试 -> 分析 -> 调优

性能测试是提前发现性能瓶颈，保障系统性能稳定

##### 微基准性能测试

只测试一个接口，忽略其他环境、接口对这个接口的影响

##### 宏基准性能测试

和 场景有关的综合测试，需要考虑测试环境(模拟线上环境)、测试场景、测试目标(TSP、qps要达到多少)。

还有当测试A接口的时候B接口也会对A有影响，二者一起来侧，如A查询接口的时候，B接口正在对通用的表进行写操作。

---

在经过性能测试之后，输出一份测试报告，其中测试结果包含测试接口的平均、最大、最小吞吐量、响应时间、服务器的CPU、内存、I/O、网络IO使用率，JVM的GC频率等。

观察这些指标，可以发现性能瓶颈，然后再自下而上分析问题，看到异常的情况，通过命令查找异常日志，通过分析日志，找到瓶颈原因。

如果系统和JVM层面都没有异常，查看业务层面是有瓶颈，如Java程序问题，读写数据瓶颈。

优化代码、优化设计、优化算法、

时间换空间

> 对时间没有要求，对存储空间要求苛刻

空间换时间

> 使用存储空间来提升访问速度，例如使用分库分表就是典型的空间换时间的设计

兜底策略

> 保证系统的稳定性，如限流，熔断就是保证系统稳定性的



