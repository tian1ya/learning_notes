### chpt01

为什么要用微服务

业务早期，业务流量小，业务迭代效率要求高，单体开发灵活，部署简单，随着业务发展，其复杂度越来越高，开发人员也越来越多，单体的一些问题就暴露出来了

* 开发效率低

代码冲突、线上特性验证难，采用灰度的方式，各个特性在验证的时候采用串行的方式上线，影响迭代效率。

* 可维护性差

所有业务代码都在一起，对于问题的排查和掌握全部内容难度大，各个功能都耦合在一起

* 架构扩展差

各个特务模块有不同的架构需求，单体服务中很难满足各个模块的差异性需求

* 部署不灵活

任何一个改动，都需要对整个服务进行发布

* 健壮性差

任何一个模块出问题，导致整个模块不可用



#### 什么微服务

微服务架构是将单个服务拆分成一系列小服务，这些小服务都拥有独立的进程，通过HTTP RESTful API之类的轻量级通信方式进行通信，而作为独立的业务服务，则可采用一些自动化部署机制独立部署，每个服务可以使用不同的开发语言和数据存储技术，实现去中心化的服务管理。



微服务架构的**核心**：支持业务敏捷开发和部署。所以其**本质**：如何优雅的支持微服务的拆分和组合。



* 康威定律

设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。

主要解决以下几个问题：

1. 架构设计必须解决沟通问题，降低沟通的复杂度，里面包含高内聚、低耦合，服务隔离等架构设计
2. 一个系统无法一次性的完美，需要迭代升级是常态，这里包含，持续集成、敏捷开发、自动部署、容错设计等
3. 人员组织结构和系统趋同，什么要的系统，就需要什么样的组织结构
4. 大系统终究会拆成小系统。合久必分，分而治之”

微服务不止是一个技术问题，更多是一个关于组织和团队的问题，系统架构和组织直接存在映射关系。

微服务可以独立开发、独立测试、独立运维，不同团队可以并行开发，互不影响，可以有力地支撑业务的快速迭代，方便业务创新和试错



* 微服务架构带来的挑战

和单体在设计、开发、测试、运维等研发流程都提出新的挑战

1. 服务拆分
2. 分布式通信，如何容错、网络不可靠性，调用超时、数据不一致
3. 分布式事务
4. 服务治理: 降级限流、超时熔断、容灾设计
5. 运维监控、部署、长链路调用问题排查、服务依赖管理

整体而言，当采用微服务的时候，对基础设施、非业务需求的处理的要求非常高。



* 服务治理

单体下是没有服务治理的概念，微服务下服务提供者和服务使用者直接会有明确的契约和规范。

**所谓服务治理就是**：解决服务提供者和服务使用者之间的链路通信和治理，主要有以下目标

1. 服务定义和SLA，向外界说明当前服务提供者具体提供了那些功能和能力，SLA(Service-LevelAgreement) 是服务提方和服务使用方之间的协议，定义了服务品质的承诺，以及达不到承诺的具体惩罚措施，服务品质主要包括QPS、调用时长等。
2. 服务注册中心，负责各个服务的地址信息、用于服务使用者查询
3. 服务生命周期管理，服务的上线、下线、扩容和缩容
4. 服务通信和链路治理，服务提供方和使用方约定的为了达成SLA而采用的一些治理手段，比如超时重试、限流降级等。
5. 服务授权和通信安全

整体达到**可见、可控、可追溯、可量化、可预测的全系统视图，立足全局、业务优先**



### chpt 03

什么是ServiceMesh

Service Mesh是一个致力于**解决服务间通信的基础设施层**，其负责在现代云原生应用的复杂服务拓扑下**解决请求的不可靠传递**，在实践中Service Mesh通常实现为一组轻量级网络代理，这些代理与应用程序部署在一起，并且对应用程序透明，对业务无侵入。

对微服务屏蔽通信的复杂度，解决微服务的通信治理问题。

Service Mesh通过将微服务通信下沉到基础设施层，屏蔽了微服务处理各种通信问题的复杂度，可以看成是微服务之间的抽象协议层，抽象层面可以看成是TCP/IP协议栈的一部分。

有了ServiceMesh之后，微服务也不再需要关注RPC通信（包含服务发现、负载均衡、流量调度、限流降级、监控统计等）的一切细节，真正像本地调用一样使用微服务。

微服务直接的调用通信方式，并不是ServiceMesh提供的，ServiceMesh提供的是提供这种通信能力的方式，将这种能力下沉到基础设施层面，以一种更加通用和标准化的方式提供。

标准化指三方面：

* 业务无侵入的分布式服务治理平台
* 提供多维度立体的可观测能力，提供体系化服务治理能力，比如限流、熔断、安全、灰度

这里标准化也是对微服务治理的标准，不同业务直接对服务治理的标准不一致，在中间沟通的过程中存在成本，使用ServiceMesh 提升全局服务治理的效率。



